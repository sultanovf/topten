{
  "hash": "4ec865c8193e5e0aa593a2d985ae197c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Top ten countries by GDP according to PPP\"\ndescription: \"Top ten countries worldwide in terms of GDP by purchasing power parity over the years, shown by animated plot\"\nauthor: \"Fazliddin Sultonov\"\ndate: \"2025-10-20\"\ndate-format: \"MMM, YYYY\"\nformat: \n    html: \n        code-fold: true\n        code-line-numbers: true\n        code-block-border-left: true\n    \nexecute: \n  eval: true\n  echo: true\n  freeze: true\n  warning: false\n  error: false\n\nknitr: \n    opts_chunk: \n      comment: \"#>\"\nfilters:\n  - lightbox\nlightbox: auto\n  # match: auto\n  # effect: fade\n  # desc-position: top\n  \n---\n\n\n![](images/intro_img.png){fig-align=\"center\"}\n\n<center>Datasource: [World Bank](https://data.worldbank.org/){text-align=\"center\"}</center>\n\n\n::: {.cell}\n\n:::\n\n\n\n## Load Data \n\n\n::: {.cell .column-screen-inset}\n\n```{.r .cell-code}\ndataraw <- read.csv2(\"data/gdp_ppp.csv\") # , sep = \";\",encoding = \"utf-8\"\nyears <- paste(1990:2024) #, sep=\",\", collapse= \",\"\nyears <- unlist(strsplit(years, \",\"))\nnew_cnames <- c(\"country\", \"ccode\",  years)\ncolnames(dataraw) <- new_cnames\n\ndata <- dataraw\nrmarkdown::paged_table(head(data)) # show sample 10 rows\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"country\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"ccode\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"1990\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"1991\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"1992\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"1993\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"1994\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"1995\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"1996\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"1997\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"1998\"],\"name\":[11],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"1999\"],\"name\":[12],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2000\"],\"name\":[13],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2001\"],\"name\":[14],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2002\"],\"name\":[15],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2003\"],\"name\":[16],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2004\"],\"name\":[17],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2005\"],\"name\":[18],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2006\"],\"name\":[19],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2007\"],\"name\":[20],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2008\"],\"name\":[21],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2009\"],\"name\":[22],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2010\"],\"name\":[23],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2011\"],\"name\":[24],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2012\"],\"name\":[25],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2013\"],\"name\":[26],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2014\"],\"name\":[27],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2015\"],\"name\":[28],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2016\"],\"name\":[29],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2017\"],\"name\":[30],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2018\"],\"name\":[31],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2019\"],\"name\":[32],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2020\"],\"name\":[33],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2021\"],\"name\":[34],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2022\"],\"name\":[35],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2023\"],\"name\":[36],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2024\"],\"name\":[37],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"China\",\"2\":\"CHN\",\"3\":\"1.12471e+12\",\"4\":\"1.27160e+12\",\"5\":\"1.48656e+12\",\"6\":\"1.73377e+12\",\"7\":\"2.00228e+12\",\"8\":\"2.26980e+12\",\"9\":\"2.54194e+12\",\"10\":\"2.82593e+12\",\"11\":\"3.08404e+12\",\"12\":\"3.36967e+12\",\"13\":\"3.74189e+12\",\"14\":\"4.14420e+12\",\"15\":\"4.59762e+12\",\"16\":\"5.16277e+12\",\"17\":\"5.83873e+12\",\"18\":\"6.71179e+12\",\"19\":\"7.79570e+12\",\"20\":\"9.13988e+12\",\"21\":\"1.02169e+13\",\"22\":\"1.12465e+13\",\"23\":\"1.25893e+13\",\"24\":\"1.40648e+13\",\"25\":\"1.54652e+13\",\"26\":\"1.66702e+13\",\"27\":\"1.77541e+13\",\"28\":\"1.85775e+13\",\"29\":\"1.96473e+13\",\"30\":\"2.09746e+13\",\"31\":\"2.28625e+13\",\"32\":\"2.47776e+13\",\"33\":\"2.57772e+13\",\"34\":\"2.94382e+13\",\"35\":\"3.25255e+13\",\"36\":\"3.55204e+13\",\"37\":\"3.81901e+13\",\"_rn_\":\"1\"},{\"1\":\"United States\",\"2\":\"USA\",\"3\":\"5.96314e+12\",\"4\":\"6.15813e+12\",\"5\":\"6.52033e+12\",\"6\":\"6.85856e+12\",\"7\":\"7.28724e+12\",\"8\":\"7.63975e+12\",\"9\":\"8.07312e+12\",\"10\":\"8.57755e+12\",\"11\":\"9.06282e+12\",\"12\":\"9.63117e+12\",\"13\":\"1.02510e+13\",\"14\":\"1.05819e+13\",\"15\":\"1.09291e+13\",\"16\":\"1.14565e+13\",\"17\":\"1.22172e+13\",\"18\":\"1.30392e+13\",\"19\":\"1.38156e+13\",\"20\":\"1.44742e+13\",\"21\":\"1.47699e+13\",\"22\":\"1.44781e+13\",\"23\":\"1.50490e+13\",\"24\":\"1.55997e+13\",\"25\":\"1.62540e+13\",\"26\":\"1.68807e+13\",\"27\":\"1.76081e+13\",\"28\":\"1.82950e+13\",\"29\":\"1.88049e+13\",\"30\":\"1.96121e+13\",\"31\":\"2.06565e+13\",\"32\":\"2.15400e+13\",\"33\":\"2.13541e+13\",\"34\":\"2.36812e+13\",\"35\":\"2.60069e+13\",\"36\":\"2.77207e+13\",\"37\":\"2.91849e+13\",\"_rn_\":\"2\"},{\"1\":\"India\",\"2\":\"IND\",\"3\":\"1.04833e+12\",\"4\":\"1.09524e+12\",\"5\":\"1.18161e+12\",\"6\":\"1.26708e+12\",\"7\":\"1.38031e+12\",\"8\":\"1.51600e+12\",\"9\":\"1.66030e+12\",\"10\":\"1.75733e+12\",\"11\":\"1.88698e+12\",\"12\":\"2.08296e+12\",\"13\":\"2.21197e+12\",\"14\":\"2.37088e+12\",\"15\":\"2.49931e+12\",\"16\":\"2.74899e+12\",\"17\":\"3.04657e+12\",\"18\":\"3.39106e+12\",\"19\":\"3.77741e+12\",\"20\":\"4.17697e+12\",\"21\":\"4.38886e+12\",\"22\":\"4.76310e+12\",\"23\":\"5.23066e+12\",\"24\":\"5.61838e+12\",\"25\":\"6.16275e+12\",\"26\":\"6.49774e+12\",\"27\":\"6.81281e+12\",\"28\":\"7.20458e+12\",\"29\":\"7.79552e+12\",\"30\":\"8.35471e+12\",\"31\":\"9.23079e+12\",\"32\":\"9.93285e+12\",\"33\":\"9.77102e+12\",\"34\":\"1.13844e+13\",\"35\":\"1.31241e+13\",\"36\":\"1.48459e+13\",\"37\":\"1.61908e+13\",\"_rn_\":\"3\"},{\"1\":\"Russian Federation\",\"2\":\"RUS\",\"3\":\"1.18787e+12\",\"4\":\"1.16606e+12\",\"5\":\"1.01933e+12\",\"6\":\"9.53037e+11\",\"7\":\"8.51034e+11\",\"8\":\"8.32875e+11\",\"9\":\"8.17527e+11\",\"10\":\"8.43110e+11\",\"11\":\"8.07029e+11\",\"12\":\"8.70676e+11\",\"13\":\"1.00058e+12\",\"14\":\"1.07459e+12\",\"15\":\"1.16790e+12\",\"16\":\"1.33866e+12\",\"17\":\"1.47334e+12\",\"18\":\"1.69673e+12\",\"19\":\"2.13319e+12\",\"20\":\"2.37745e+12\",\"21\":\"2.87820e+12\",\"22\":\"2.76860e+12\",\"23\":\"2.92700e+12\",\"24\":\"3.25932e+12\",\"25\":\"3.48030e+12\",\"26\":\"3.74178e+12\",\"27\":\"3.76353e+12\",\"28\":\"3.52624e+12\",\"29\":\"3.53898e+12\",\"30\":\"3.80710e+12\",\"31\":\"4.23184e+12\",\"32\":\"4.57955e+12\",\"33\":\"4.65143e+12\",\"34\":\"5.68827e+12\",\"35\":\"6.00631e+12\",\"36\":\"6.47648e+12\",\"37\":\"6.92125e+12\",\"_rn_\":\"4\"},{\"1\":\"Japan\",\"2\":\"JPN\",\"3\":\"2.45876e+12\",\"4\":\"2.63147e+12\",\"5\":\"2.71568e+12\",\"6\":\"2.76728e+12\",\"7\":\"2.85699e+12\",\"8\":\"2.99364e+12\",\"9\":\"3.14399e+12\",\"10\":\"3.22959e+12\",\"11\":\"3.22445e+12\",\"12\":\"3.25897e+12\",\"13\":\"3.46120e+12\",\"14\":\"3.55284e+12\",\"15\":\"3.64793e+12\",\"16\":\"3.75392e+12\",\"17\":\"3.93896e+12\",\"18\":\"4.11044e+12\",\"19\":\"4.30032e+12\",\"20\":\"4.48208e+12\",\"21\":\"4.51727e+12\",\"22\":\"4.29563e+12\",\"23\":\"4.52540e+12\",\"24\":\"4.62940e+12\",\"25\":\"4.79961e+12\",\"26\":\"5.02159e+12\",\"27\":\"5.03445e+12\",\"28\":\"5.20091e+12\",\"29\":\"5.15890e+12\",\"30\":\"5.26225e+12\",\"31\":\"5.34406e+12\",\"32\":\"5.40446e+12\",\"33\":\"5.35671e+12\",\"34\":\"5.57465e+12\",\"35\":\"5.93040e+12\",\"36\":\"6.21296e+12\",\"37\":\"6.40767e+12\",\"_rn_\":\"5\"},{\"1\":\"Germany\",\"2\":\"DEU\",\"3\":\"1.55061e+12\",\"4\":\"1.68494e+12\",\"5\":\"1.75812e+12\",\"6\":\"1.78058e+12\",\"7\":\"1.86386e+12\",\"8\":\"1.92882e+12\",\"9\":\"1.97907e+12\",\"10\":\"2.02164e+12\",\"11\":\"2.08762e+12\",\"12\":\"2.17713e+12\",\"13\":\"2.25817e+12\",\"14\":\"2.36156e+12\",\"15\":\"2.43454e+12\",\"16\":\"2.50122e+12\",\"17\":\"2.62050e+12\",\"18\":\"2.66490e+12\",\"19\":\"2.86248e+12\",\"20\":\"3.03689e+12\",\"21\":\"3.15660e+12\",\"22\":\"3.07580e+12\",\"23\":\"3.24904e+12\",\"24\":\"3.48380e+12\",\"25\":\"3.55719e+12\",\"26\":\"3.70075e+12\",\"27\":\"3.88220e+12\",\"28\":\"3.96657e+12\",\"29\":\"4.24671e+12\",\"30\":\"4.47259e+12\",\"31\":\"4.66536e+12\",\"32\":\"4.92498e+12\",\"33\":\"4.88037e+12\",\"34\":\"5.20231e+12\",\"35\":\"5.66389e+12\",\"36\":\"5.76347e+12\",\"37\":\"6.03785e+12\",\"_rn_\":\"6\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n## prepare data\n\n### pivot long\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfdec <- function(x) round(x/1000000000000, digits = 2) # trl to mlr\ndf <-\n  data |> \n  mutate(across(!c(country, ccode), fdec)) |> \n  pivot_longer(\n    cols = !c(country, ccode),\n    names_to = \"year\",\n    values_to = \"gdp\"\n  ) |> \n  mutate(year = as.integer(year))\n\nhead(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> # A tibble: 6 × 4\n#>   country ccode  year   gdp\n#>   <chr>   <chr> <int> <dbl>\n#> 1 China   CHN    1990  1.12\n#> 2 China   CHN    1991  1.27\n#> 3 China   CHN    1992  1.49\n#> 4 China   CHN    1993  1.73\n#> 5 China   CHN    1994  2   \n#> 6 China   CHN    1995  2.27\n```\n\n\n:::\n:::\n\n\n### top 10 countries by each year\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_top <-\n  df |> \n  #select(-ccode) |> \n  group_by(year) |> \n  slice_max(order_by = gdp, n = 10) |> \n  arrange(year, desc(gdp)) |> \n  mutate(rank= 1:n()) |> \n  ungroup()\n\ndf_top |> \n  arrange(desc(year)) |> \n  head(n = 12)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> # A tibble: 12 × 5\n#>    country            ccode  year   gdp  rank\n#>    <chr>              <chr> <int> <dbl> <int>\n#>  1 China              CHN    2024 38.2      1\n#>  2 United States      USA    2024 29.2      2\n#>  3 India              IND    2024 16.2      3\n#>  4 Russian Federation RUS    2024  6.92     4\n#>  5 Japan              JPN    2024  6.41     5\n#>  6 Germany            DEU    2024  6.04     6\n#>  7 Brazil             BRA    2024  4.73     7\n#>  8 Indonesia          IDN    2024  4.66     8\n#>  9 France             FRA    2024  4.2      9\n#> 10 United Kingdom     GBR    2024  4.2     10\n#> 11 China              CHN    2023 35.5      1\n#> 12 United States      USA    2023 27.7      2\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n:::\n\n\n\n## df for plot\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# df for plot\ndf_plt <- \n  df_top |> \n  mutate(cflags = paste0(\"images/\", ccode, \".png\")) |>\n  mutate(\n    country = case_when(\n      country == \"United States\" ~ \"USA\",\n      country == \"United Kingdom\" ~ \"UK\",\n      country == \"Russian Federation\" ~ \"Russia\",\n      TRUE ~ country\n    )\n  )\n#\n```\n:::\n\n\n# plot\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_plt |>  \n  filter(year == 2024) |> \n  ggplot(aes(x = reorder(country, gdp), y = gdp)) +\n    geom_col(fill = \"steelblue\", alpha = 0.6) +\n    geom_image(aes(image = cflags, y = -2.3),  size = 0.13, by = \"width\") + \n    scale_y_continuous(labels = function(y) ifelse(y == 0, paste0(y), paste0(y, \"k\"))) +\n    geom_text(aes(label = gdp), hjust = -0.1, color = \"darkgrey\", fontface = \"bold\") +\n    labs(\n      x = NULL, y = \"GDP, PPP in Mlrd. in USD (k = 1000)\", \n      title = \"**Top ten countries by GDP, PPP in 2024**\",\n      caption = social_caption) +\n    #geom_label(aes(label = paste(\"Year:\",year)), x = 2, y = 30, size = 10, fill = \"white\", col = \"gray\") +\n    coord_flip() +\n    theme_minimal() +\n    theme(\n      plot.title = ggtext::element_markdown(size=14, color=\"steelblue4\", hjust = 0.5),\n      plot.caption = ggtext::element_markdown(size=14, hjust = 0.5),\n      plot.background = element_rect(fill = \"ghostwhite\"),\n      panel.grid.major.y = element_blank(),\n      panel.grid.minor.y = element_blank(),\n      panel.grid.minor.x = element_blank(),\n      axis.line.x =  element_line(colour = \"gray\")\n    )\n```\n\n::: {.cell-output-display}\n![](topten_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n## animated plot over the years\n\n::: {.cell}\n\n```{.r .cell-code}\nplt <-\n  df_plt |>  \n  ggplot(aes(x = reorder(rank, gdp), y = gdp)) +\n    geom_col(fill = \"steelblue\", alpha = 0.6) +\n    geom_image(aes(image = cflags, y = -2.3),  size = 0.13, by = \"width\") + \n    scale_y_continuous(labels = function(y) ifelse(y == 0, paste0(y), paste0(y, \"k\"))) +\n    geom_text(aes(label = gdp), hjust = -0.1, color = \"darkgrey\", fontface = \"bold\") +\n    geom_label(aes(label = paste(\"Year:\",year)), x = 2, y = 30, size = 8, fill = \"white\", col = \"gray\") +\n    labs(\n      x = NULL, y = \"GDP, PPP in Mlrd. in USD (k = 1000)\", \n      title = \"**Top ten countries by GDP, PPP in 1990-2024**\",\n      caption = social_caption) +\n    coord_flip() +\n    theme_minimal() +\n    theme(\n      plot.title = element_markdown(size=14, color=\"steelblue4\", hjust = 0.5),\n      plot.caption = ggtext::element_markdown(size=14, hjust = 0.5),\n      plot.background = element_rect(fill = \"ghostwhite\"),\n      panel.grid.major.y = element_blank(),\n      panel.grid.minor.y = element_blank(),\n      panel.grid.minor.x = element_blank(),\n      axis.line.x =  element_line(colour = \"gray\")\n    )\n plt_anim <-\n  plt +\n  transition_states(year, wrap = FALSE, transition_length = 1, state_length = 1) +\n  enter_fade() + \n  exit_fade()\n\nanim <- animate(\n  plt_anim,\n  duration = 45,\n  start_pause =5,\n  end_pause = 5,\n  renderer = gifski_renderer()\n)\nanim\n```\n\n::: {.cell-output-display}\n![](topten_files/figure-html/unnamed-chunk-8-1.gif)\n:::\n:::\n\n\n",
    "supporting": [
      "topten_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"topten_files/libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"topten_files/libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}